"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const fs = require("fs");
const ical2json_1 = require("./ical2json");
const cwd = process.cwd();
/**
 * Pass in options to parse and generate JSON files
 * @param {Object} options
 * @return {Promise}
 */
function default_1(options) {
    const files = options.args || [];
    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const filePath = path.resolve(cwd, file);
        if (!fs.existsSync(filePath)) {
            continue;
        }
        const stat = fs.statSync(filePath);
        const ext = path.extname(filePath);
        const isConvert = !options.revert && ext === '.ics';
        const isRevert = options.revert && ext === '.json';
        if (!stat.isFile() || (!isConvert && !isRevert)) {
            continue;
        }
        const buffer = fs.readFileSync(filePath);
        let output;
        const data = buffer.toString();
        if (isConvert) {
            output = (0, ical2json_1.convert)(data);
            output = JSON.stringify(output, null, '  ');
        }
        else if (isRevert) {
            output = (0, ical2json_1.revert)(JSON.parse(data));
        }
        if (!output)
            continue;
        const basename = path.basename(filePath, ext);
        const dirname = path.dirname(filePath);
        const compiledExt = isConvert ? '.json' : '.ics';
        const writePath = path.join(dirname, basename) + compiledExt;
        fs.writeFileSync(writePath, output);
    }
    return true;
}
exports.default = default_1;
